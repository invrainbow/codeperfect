#!/bin/bash
set -e

cmd="make"
if [ "$(sysctl -n machdep.cpu.brand_string)" = "Apple M1" ]; then
    cmd="arch -arm64 $cmd"
fi

nprocs=$(sysctl hw.ncpu | grep -o '[0-9]\+')
$cmd -j $nprocs $@
